<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestión de Ventas - Cuyes</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
    <style>
        :root {
            --primary-color: #4e73df;
            --secondary-color: #1cc88a;
            --light-color: #f8f9fc;
            --dark-color: #5a5c69;
            --danger-color: #e74a3b;
        }
        
        body {
            background-color: #f8f9fc;
            font-family: 'Nunito', sans-serif;
        }
        
        .navbar-custom {
            background: linear-gradient(90deg, var(--primary-color) 0%, #2a3e9d 100%);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .card-custom {
            border-radius: 10px;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
            margin-bottom: 1.5rem;
            border: none;
        }
        
        .card-header-custom {
            background: linear-gradient(90deg, var(--primary-color) 0%, #2a3e9d 100%);
            color: white;
            border-radius: 10px 10px 0 0 !important;
            padding: 1rem 1.35rem;
        }
        
        .stats-card {
            border-left: 4px solid;
            border-radius: 5px;
        }
        
        .stats-card.destetados {
            border-left-color: var(--primary-color);
        }
        
        .stats-card.descarte {
            border-left-color: var(--secondary-color);
        }
        
        .stats-card.total {
            border-left-color: var(--dark-color);
        }
        
        .stats-icon {
            font-size: 2rem;
            opacity: 0.3;
        }
        
        .btn-primary-custom {
            background: linear-gradient(90deg, var(--primary-color) 0%, #2a3e9d 100%);
            border: none;
            border-radius: 5px;
            padding: 10px 20px;
            font-weight: 600;
        }
        
        .btn-primary-custom:hover {
            background: linear-gradient(90deg, #2a3e9d 0%, var(--primary-color) 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(78, 115, 223, 0.25);
        }
        
        .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(78, 115, 223, 0.25);
        }
        
        .alert-custom {
            border-radius: 8px;
            border: none;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark navbar-custom mb-4">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-paw me-2"></i>
                <strong>Sistema de Gestión de Cuyes</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#"><i class="fas fa-shopping-cart me-1"></i> Ventas</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="fas fa-list me-1"></i> Inventario</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="fas fa-chart-line me-1"></i> Reportes</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="fas fa-cog me-1"></i> Configuración</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h3 mb-0 text-gray-800"><i class="fas fa-shopping-cart text-primary me-2"></i> Registro de Ventas</h1>
            <button class="btn btn-sm btn-outline-primary">
                <i class="fas fa-history me-1"></i> Ver Historial
            </button>
        </div>

        <!-- Mensajes flash -->
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="alert alert-{{ category }} alert-custom alert-dismissible fade show" role="alert">
                  <i class="fas fa-{% if category == 'success' %}check-circle{% else %}exclamation-circle{% endif %} me-2"></i>
                  {{ message }}
                  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        <!-- Estadísticas -->
        <div class="row mb-4">
            <div class="col-xl-4 col-md-6 mb-4">
                <div class="card card-custom h-100 stats-card destetados">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Ventas Hoy (Destetados)</div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800">{{ ventas_destetados_hoy }}</div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-calendar-day stats-icon text-primary"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xl-4 col-md-6 mb-4">
                <div class="card card-custom h-100 stats-card descarte">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Ventas Este Mes (Destetados)</div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800">{{ ventas_destetados_mes }}</div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-calendar stats-icon text-success"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xl-4 col-md-6 mb-4">
                <div class="card card-custom h-100 stats-card total">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-gray-800 text-uppercase mb-1">Total Ventas (Destetados)</div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800">{{ total_ventas_destetados }}</div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-dollar-sign stats-icon text-gray-800"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Formulario de venta -->
        <div class="card card-custom">
            <div class="card-header card-header-custom">
                <h5 class="card-title mb-0"><i class="fas fa-plus-circle me-2"></i>Nueva Venta</h5>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('ventas') }}">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="tipo_venta" class="form-label">Tipo de venta:</label>
                            <select id="tipo_venta" name="tipo_venta" class="form-select" required onchange="toggleFields()">
                                <option value="">Seleccione...</option>
                                <option value="destetados">Destetados</option>
                                <option value="descarte">Descarte</option>
                            </select>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="galpon" class="form-label">Galpón:</label>
                            <select id="galpon" name="galpon" class="form-select" required>
                                <option value="">Seleccione galpón</option>
                                {% for r in galpones_pozas %}
                                    <option value="{{ r['galpon'] }}">{{ r['galpon'] }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="poza" class="form-label">Poza:</label>
                            <select id="poza" name="poza" class="form-select" required>
                                <option value="">Seleccione poza</option>
                                {% for r in galpones_pozas %}
                                    <option value="{{ r['poza'] }}">{{ r['poza'] }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="costo_venta" class="form-label">Costo total (S/):</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-dollar-sign"></i></span>
                                <input type="number" step="0.01" min="0" id="costo_venta" name="costo_venta" class="form-control" required>
                            </div>
                        </div>
                    </div>

                    <!-- Destetados -->
                    <div id="destetados_fields" style="display:none;">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="hembras_vendidas" class="form-label">Hembras vendidas:</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-venus"></i></span>
                                    <input type="number" id="hembras_vendidas" name="hembras_vendidas" class="form-control" min="0" value="0">
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="machos_vendidos" class="form-label">Machos vendidos:</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-mars"></i></span>
                                    <input type="number" id="machos_vendidos" name="machos_vendidos" class="form-control" min="0" value="0">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Descarte -->
                    <div id="descarte_fields" style="display:none;">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="cuyes_vendidos" class="form-label">Cuyes vendidos:</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-paw"></i></span>
                                    <input type="number" id="cuyes_vendidos" name="cuyes_vendidos" class="form-control" min="0" value="0">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                        <button type="reset" class="btn btn-secondary me-md-2"><i class="fas fa-eraser me-1"></i> Limpiar</button>
                        <button type="submit" class="btn btn-primary-custom"><i class="fas fa-save me-1"></i> Registrar Venta</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <footer class="text-center text-muted mt-5 mb-4">
        <div class="container">
            <hr>
            <p>Sistema de Gestión de Cuyes © 2023 - Desarrollado por Javh9</p>
        </div>
    </footer>

    <script>
    function toggleFields() {
        const tipo = document.getElementById('tipo_venta').value;
        document.getElementById('destetados_fields').style.display = tipo === 'destetados' ? 'block' : 'none';
        document.getElementById('descarte_fields').style.display = tipo === 'descarte' ? 'block' : 'none';
        
        // Reset campos cuando se cambia el tipo
        if (tipo !== 'destetados') {
            document.getElementById('hembras_vendidas').value = "0";
            document.getElementById('machos_vendidos').value = "0";
        }
        
        if (tipo !== 'descarte') {
            document.getElementById('cuyes_vendidos').value = "0";
        }
    }
    
    // Mejorar la experiencia de usuario con los selects
    document.addEventListener('DOMContentLoaded', function() {
        const galponSelect = document.getElementById('galpon');
        const pozaSelect = document.getElementById('poza');
        
        // Si se necesita alguna funcionalidad adicional para los selects
    });
    </script>
</body>
</html>