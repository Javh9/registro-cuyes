<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Registro de Ventas</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
</head>
<body>
<div class="container mt-4">

    <h1>Registro de Ventas</h1>

    <!-- Mensajes flash -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <!-- Estadísticas -->
    <div class="mb-4">
        <h4>Estadísticas de ventas de destetados</h4>
        <ul>
            <li>Hoy: {{ ventas_destetados_hoy }}</li>
            <li>Este mes: {{ ventas_destetados_mes }}</li>
            <li>Total: {{ total_ventas_destetados }}</li>
        </ul>
    </div>

    <!-- Formulario de venta -->
    <form method="POST" action="{{ url_for('ventas') }}">
        <div class="mb-3">
            <label for="tipo_venta" class="form-label">Tipo de venta:</label>
            <select id="tipo_venta" name="tipo_venta" class="form-select" required onchange="toggleFields()">
                <option value="">Seleccione...</option>
                <option value="destetados">Destetados</option>
                <option value="descarte">Descarte</option>
            </select>
        </div>

        <div class="mb-3">
            <label for="galpon" class="form-label">Galpón:</label>
            <select id="galpon" name="galpon" class="form-select" required>
                <option value="">Seleccione galpón</option>
                {% for r in galpones_pozas %}
                    <option value="{{ r['galpon'] }}">{{ r['galpon'] }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-3">
            <label for="poza" class="form-label">Poza:</label>
            <select id="poza" name="poza" class="form-select" required>
                <option value="">Seleccione poza</option>
                {% for r in galpones_pozas %}
                    <option value="{{ r['poza'] }}">{{ r['poza'] }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- Destetados -->
        <div id="destetados_fields" style="display:none;">
            <div class="mb-3">
                <label for="hembras_vendidas" class="form-label">Hembras vendidas:</label>
                <input type="number" id="hembras_vendidas" name="hembras_vendidas" class="form-control" min="0" value="0">
            </div>
            <div class="mb-3">
                <label for="machos_vendidos" class="form-label">Machos vendidos:</label>
                <input type="number" id="machos_vendidos" name="machos_vendidos" class="form-control" min="0" value="0">
            </div>
        </div>

        <!-- Descarte -->
        <div id="descarte_fields" style="display:none;">
            <div class="mb-3">
                <label for="cuyes_vendidos" class="form-label">Cuyes vendidos:</label>
                <input type="number" id="cuyes_vendidos" name="cuyes_vendidos" class="form-control" min="0" value="0">
            </div>
        </div>

        <div class="mb-3">
            <label for="costo_venta" class="form-label">Costo total:</label>
            <input type="number" step="0.01" min="0" id="costo_venta" name="costo_venta" class="form-control" required>
        </div>

        <button type="submit" class="btn btn-primary">Registrar venta</button>
    </form>
</div>

<script>
function toggleFields() {
    const tipo = document.getElementById('tipo_venta').value;
    document.getElementById('destetados_fields').style.display = tipo === 'destetados' ? 'block' : 'none';
    document.getElementById('descarte_fields').style.display = tipo === 'descarte' ? 'block' : 'none';
}
</script>

</body>
</html>
